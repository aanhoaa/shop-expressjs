<% include ../../partials/header %>
<link rel="stylesheet" href="/stylesheets/css/checkout.css">
<script src="/javascripts/js/buyer/cart.js"></script>

<div class="col-lg-12">
    <h1 class="page-header" style="margin-left: 10%;">Thanh toán
    </h1>
</div>

<div role="main" class="_1WlhIE">
    <div class="_1iurwE">
       <div class="_1G9Cv7"></div>
       <div class="_1gkIPw">
        <div class="_1TKMuK">
           <div class="_20Qrq_">
              <svg height="16" viewBox="0 0 12 16" width="12" class="shopee-svg-icon icon-location-marker">
                 <path d="M6 3.2c1.506 0 2.727 1.195 2.727 2.667 0 1.473-1.22 2.666-2.727 2.666S3.273 7.34 3.273 5.867C3.273 4.395 4.493 3.2 6 3.2zM0 6c0-3.315 2.686-6 6-6s6 2.685 6 6c0 2.498-1.964 5.742-6 9.933C1.613 11.743 0 8.498 0 6z" fill-rule="evenodd"></path>
              </svg>
              Địa chỉ nhận hàng
           </div>
        </div>
        <div class="Jgz_oc">
           <div class="_2Pe7Hh">
              <div class="book-name"><%-book[0].fullname%> <%-book[0].phone%></div>
              <div class="book-address"><%-book[0].identity_name%>, <%-book[0].ward_name%>, <%-book[0].district_name%>, <%-book[0].province_name%></div>
           </div>
           <div class="change-book">
               <a href="/user/account/address"><button>Thiết lập địa chỉ</button></a>
           </div>
        </div>
        <div></div>
     </div>
    </div>

    <div class="border-cart" style="box-shadow: 0 1px 3px 0 rgba(0,0,0,.2);">
                
        <% if (data) 
            { 
                if (data.length >= 1) {%>
        <div class="khoimenu_title" style="display: flex; border-bottom: solid 1px #b1b1b1;">
            <div class="col-sm-4">
                <label class="khoimenu_title_text">Sản phẩm</label>
            </div>
            <div class="col-sm-2">
                <label class="khoimenu_title_text">Đơn giá</label>
            </div>
            <div class="col-sm-2">
                <label class="khoimenu_title_text">Số lượng</label>
            </div>
            <div class="col-sm-2">
                <label class="khoimenu_title_text">Thành tiền</label>
            </div>
        </div>
        <%var i = 0;
        var a = '';
        var total = 0;
        var ship = 0;
        var arrAmount = [];
        var arrPVD = [];
        var arrShop = [];
        var arrShip = [];
        var totalFee = 0;
        %>
        <%data.forEach((item) => {i++;%>
            <%ship = 0;
                totalShop = 0;
            arrShop.push(item.shopId)
            %>
            <div class="clearfix" style="border: 1px solid rgba(0,0,0,0.09);">
            <div>
                <div class="col-sm-12 shop-name">
                    <div class="_3xIZfd">
                        <div class="_1tj6iU">
                            
                            <div class="_2zTpu5">
                                <img src="/images/boy.png" alt="" width="20px" height="20px">
                            </div>
                            <div class="_2tDqUs"><%-item.shopName%></div>
                        </div>
                        </div>
                </div>
        <%item.products.forEach(i => {%>
            <%
            arrAmount.push(i.amount);
            arrPVD.push(i.pvdId);
            %>
        <div class="khoimenu product-shop">
            <div class="col-sm-4" style="display: flex;">
                <img class="hinhsanpham" src="<%-i.cover%>" alt="" >
                <div class="product_info">
                    <label class="product_info_text"><%-i.name%> </label>
                    <small class="product_info_small">(<%-i.color%> <%-i.size%>)</small>
                </div>
            </div>

            <div class="col-sm-2">
                
                <span><%-VND(parseInt(i.price))%></span>
                <input type="hidden" class="price" value="">
            </div>
            <div class="col-sm-2">
                <div class="input-group get-info">
                    <span class="input-group-btn">
                        <%-i.amount%>
                    </span>
                    <input type="hidden" value="<%-item.color%>" class="color">
                    <input type="hidden" value="<%-item.size%>" class="size">
                    <input type="hidden" value="<%-item.id%>" class="pvid">
                </div>
            </div>
            <div class="col-sm-2">

                <span id="payment_total"><%-VND(i.amount * i.price)%></span>
                <%total += i.amount * i.price%>     
                <%ship += i.fee%>  
                <%totalShop+=i.amount * i.price%>                           
            </div>
        </div>
            
        <%})%>
    </div>
    <div class="shop-voucher col-sm-12 clearfix">
        <div class="col-sm-6 voucher" style="display: flex; float: right;">
            <div class="col-sm-6 title-voucher">
                <p>Voucher của shop</p>
            </div>
            <div class="col-sm-6 btn-voucher">
               <button style="float: right;" class="btn btn-primary"> Chọn voucher</button>
            </div>
        </div>
    </div>
    <% totalFee += ship;%>
    <div style="display: flex; float: right; margin: 25px;">
        <div style="margin-right: 20px;">
            <div> 
                Phí vận chuyển
            </div>
            <div>
                Tổng tiền sản phẩm
            </div>
        </div>
        <div>
            <div>
                <%-VND(ship)%>
            </div>
            <div> <%-VND(ship+totalShop)%></div>
            <%arrShip.push(ship)%>
        </div>
    </div>
        </div>
        <%})%>
           
            <%}}%>
           
            </div>
           

    <div class="f23wB9">
       <div class="qXX2_B">
          <div>
             <div class="checkout-payment-method-view__current checkout-payment-setting">
                <div class="checkout-payment-method-view__current-title">Phương thức thanh toán: </div>
                <div class="checkout-payment-setting__payment-methods-tab" style="margin-left: 10px;">
                   <span tabindex="0">
                       <button class="product-variation" data-method=2>VNPay</button>
                    </span>
                    <span tabindex="0">
                        <button class="product-variation" data-method=1>Thanh toán khi nhận hàng</button>
                    </span>
                </div>
             </div>
          </div>
       </div>
       <div class="PC1-mc">
          <div class="_1i3wS2 _1X3--o RihLPS">Tổng tiền hàng</div>
          <div class="_1i3wS2 lsNObX RihLPS"><%-VND(total)%></div>
          <div class="_1i3wS2 _1X3--o RRMXiE">Phí vận chuyển</div>
          <div class="_1i3wS2 lsNObX RRMXiE"><%-VND(totalFee)%></div>
          <div class="_1i3wS2 _1X3--o _3QL9JJ">Tổng thanh toán:</div>
          <div class="_1i3wS2 _20-5lO lsNObX _3QL9JJ"><%-VND(total + totalFee)%></div>
          <div class="_3Q9F5R _1Q3ggw">
             <div class="_2xyh_G">Nhấn "Đặt hàng" đồng nghĩa với việc bạn đồng ý tuân theo <a href="https://shopee.vn/legaldoc/policies/" target="_blank" rel="noopener noreferrer">Điều khoản Shopee</a>
            </div>
             <form action="/checkout" method="POST">
               <input type="text" hidden name="arrAmount" value="<%-arrAmount%>">
               <input type="text" hidden name="arrPVD" value="<%-arrPVD%>">
               <input type="text" hidden name="arrShop" value="<%-arrShop%>">
               <input type="text" hidden name="arrShip" value="<%-arrShip%>">
               <input type="text" hidden name="paymentmethod" value="" id="payment-method">
               <button class="stardust-button stardust-button--primary stardust-button--large _1qSlAe _2a74ER" id="pay" disabled>Đặt hàng
               </button>
             </form>
          </div>
       </div>
    </div>
 </div>


<% include ../../partials/footer %>